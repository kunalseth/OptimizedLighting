<!DOCTYPE html>
<meta charset="utf-8">

<head>
    <title>Optimum Lighting Decisions</title>
</head>

<body>

<div id="bulbs" style="margin-top: 30px; margin-left: 50px; float: left;" ></div>
<div id="bulbs2" style="margin-top: 30px; margin-left: 50px; float: right;"></div>
<script src="scripts/d3.min.js"></script>
<script type="text/javascript">	


var width = 500,
    height = 500;

no_of_bulbs = [18];

var svg = d3.select("#bulbs").selectAll("svg")
    .data(no_of_bulbs)
  	.enter().append("svg")
    .attr("width", width)
    .attr("height", height);

svg.append("g")
    .attr("transform", "translate(" + [width / 2, height / 2] + ")")
    .each(function(d) {
      d3.select(this).call(bulb_placement, primeFactors(d), width / 2);
    });

    var svg = d3.select("#bulbs2").selectAll("svg")
    .data(no_of_bulbs)
  	.enter().append("svg")
    .attr("width", width)
    .attr("height", height);

svg.append("g")
    .attr("transform", "translate(" + [width / 2, height / 2] + ")")
    .each(function(d) {
      d3.select(this).call(bulb_placement, primeFactors(d), width / 2);
    });

function bulb_placement(selection, factors, size) {
	var radialGradient = svg.append("defs")
	  	.append("radialGradient")
	    .attr("id", "radial-gradient");

	radialGradient.append("stop")
	    .attr("offset", "0%")
	    .attr("stop-color", "red");

	radialGradient.append("stop")
	    .attr("offset", "100%")
	    .attr("stop-color", "#fff");

	  if (factors.length) {
	    
	    // Retrieving factors one by one from the prime factorization array
	    var n = factors.pop();
	    
	    //  calculating the adjustment in angle based on the factor 
	    if (n === 4){
	    	offset = 45; // 45 degrees will place the 4 bulbs in the 4 corners of a square
	    }
	        else if (n === 2) {
	        	offset = 0; // 0 degrees will place the 2 bulbs side by side
	        }
		        else {
		        	offset = -90; // -90 degrees will club the bulbs in the form of a triangle
		        };
		// Calculating the radius of the circle based on the number of bulbs 
	    radius = n * size / (n + 2);
	    
	    // Displacement in the y coordinate between 2 bulbs in the same cluster
	    dy = n & 1 ? (radius / 2) * (1 - Math.cos(3.14 / n)) : 0;

	    // Create empty placeholders for all factors n
	    selection.selectAll("g")
	        .data(d3.range(n))
	      	.enter().append("g")
	        .attr("transform", function(d) {
	          var angle = d * 360 / n + offset;
	          return "translate(0," + dy + ")rotate(" + angle + ")translate(" + radius + ")rotate(" + - angle + ")";
	        })
	        .call(bulb_placement, factors, 2 * size / (n + 2));
	  } 
	  // append the bulbs 
	  else selection.append("circle").attr("r", size * 1.5).style("opacity","1").style("fill", "url(#radial-gradient)");
}

// Function to calculate the prime factors of the number of bulbs to find the combinations
function primeFactors(n) {
  var factors = [],
      f;
  while (n > 1) {
    factors.push(f = factor(n)); // Calling the function for finding the factors
    n /= f;
  }
  return factors;
}

function factor(n) {
  // Preserving the combination of 4 bulbs
  if (n % 4 === 0) return 4;

  for (var i = 2; i <= n / 2; i++) {
    if (n % i === 0) return i;
  }
  
  return n;
}

</script>

</body>